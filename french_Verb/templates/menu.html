<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Verb Quiz</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        text-align: center;
        padding: 0;
      }
      h1 {
        font-size: 2.2em;
        margin-bottom: 16px;
      }
      .row {
        display: flex;
        justify-content: center;
        gap: 24px;
        align-items: center;
      }
      .lang-select {
        padding: 10px 12px;
        font-size: 16px;
        border-radius: 6px;
        border: 1px solid #ccc;
        background: #fff;
      }
      .button {
        margin: 15px auto;
        padding: 15px 30px;
        font-size: 18px;
        background: #3498db;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: block;
        width: 280px;
      }
      .button:hover {
        background: #2980b9;
      }
      .tense-grid {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin: 14px 0 24px;
        text-align: left;
        align-items: flex-start;
      }
      .tense-col label {
        display: block;
        margin: 6px 0;
      }
      .note {
        color: #666;
        font-size: 13px;
        margin-top: 6px;
      }
    </style>
  </head>
  <body>
    <h1>Verb Conjugation Quiz</h1>

    <div class="row" style="margin-bottom: 8px">
      <div>
        <strong>è¨€èª / Langue / Lingua:</strong>
        <select id="lang" class="lang-select" aria-label="language select">
          <option value="fr">FranÃ§ais (ãƒ•ãƒ©ãƒ³ã‚¹èª)</option>
          <option value="it">Italiano (ã‚¤ã‚¿ãƒªã‚¢èª)</option>
        </select>
      </div>
    </div>

    <h3>å‡ºé¡Œã™ã‚‹æ™‚åˆ¶ã‚’é¸ã‚“ã§ãã ã•ã„ï¼ˆè¤‡æ•°å¯ï¼‰</h3>
    <div id="tense-options" class="tense-grid"></div>
    <div class="note">
      â€»ã€Œã™ã¹ã¦ã€ã‚’é¸ã¶ã¨ä»–ã®ãƒã‚§ãƒƒã‚¯ã¯å¤–ã‚Œã¾ã™ã€‚æœªé¸æŠãªã‚‰è‡ªå‹•çš„ã«ã€Œã™ã¹ã¦ã€ã«ãªã‚Šã¾ã™ã€‚
    </div>

    <button class="button" onclick="startQuiz('normal')">
      â–¶ ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œ
    </button>
    <button class="button" onclick="startQuiz('by_subject')">
      ğŸ”¢ äººç§°ã‚’é †ç•ªã«å‡ºé¡Œ
    </button>
    <button class="button" id="review-button" onclick="startQuiz('review')">
      ğŸ” é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’
    </button>
    <button class="button" onclick="resetQuiz()">âŒ è§£ç­”çŠ¶æ³ã‚’ãƒªã‚»ãƒƒãƒˆ</button>

    <div style="margin-top: 30px">
      <img
        src="/static/menu.gif"
        alt="menuGIF"
        style="height: 200px; display: block; margin: 0 auto"
      />
    </div>

    <script>
      const TENSES = {
        fr: [
          { value: "ALL", label: "ã™ã¹ã¦ (tous les temps)" },
          { value: "prÃ©sent", label: "ç¾åœ¨ (prÃ©sent)" },
          { value: "futur simple", label: "å˜ç´”æœªæ¥ (futur simple)" },
          { value: "imparfait", label: "åŠéå» (imparfait)" },
          { value: "passÃ© composÃ©", label: "è¤‡åˆéå» (passÃ© composÃ©)" },
          { value: "impÃ©ratif", label: "å‘½ä»¤æ³• (impÃ©ratif)" },
          {
            value: "conditionnel_prÃ©sent",
            label: "æ¡ä»¶æ³•ç¾åœ¨ (conditionnel prÃ©sent)",
          },
          {
            value: "conditionnel_passÃ©",
            label: "æ¡ä»¶æ³•éå» (conditionnel passÃ©)",
          },
          {
            value: "subjonctif_prÃ©sent",
            label: "æ¥ç¶šæ³•ç¾åœ¨ (subjonctif prÃ©sent)",
          },
          { value: "subjonctif_passÃ©", label: "æ¥ç¶šæ³•éå» (subjonctif passÃ©)" },
        ],
        it: [
          { value: "ALL", label: "ã™ã¹ã¦ (tutti i tempi)" },
          { value: "presente", label: "ç¾åœ¨ (presente)" },
          { value: "futuro semplice", label: "å˜ç´”æœªæ¥ (futuro semplice)" },
          { value: "imperfetto", label: "åŠéå» (imperfetto)" },
          { value: "passato prossimo", label: "è¿‘éå» (passato prossimo)" },
          { value: "imperativo", label: "å‘½ä»¤æ³• (imperativo)" },
          {
            value: "condizionale presente",
            label: "æ¡ä»¶æ³•ç¾åœ¨ (condizionale presente)",
          },
          {
            value: "condizionale passato",
            label: "æ¡ä»¶æ³•éå» (condizionale passato)",
          },
          {
            value: "congiuntivo presente",
            label: "æ¥ç¶šæ³•ç¾åœ¨ (congiuntivo presente)",
          },
          {
            value: "congiuntivo passato",
            label: "æ¥ç¶šæ³•éå» (congiuntivo passato)",
          },
        ],
      };

      function splitInTwo(arr) {
        const mid = Math.ceil(arr.length / 2);
        return [arr.slice(0, mid), arr.slice(mid)];
      }

      function renderTenseCheckboxes(lang) {
        const container = document.getElementById("tense-options");
        container.innerHTML = "";
        const data = TENSES[lang];
        const [left, right] = splitInTwo(data);

        const col1 = document.createElement("div");
        col1.className = "tense-col";
        left.forEach((t) => {
          const label = document.createElement("label");
          label.innerHTML = `<input type="checkbox" value="${t.value}" ${
            t.value === "ALL" ? "checked" : ""
          }/> ${t.label}`;
          col1.appendChild(label);
        });

        const col2 = document.createElement("div");
        col2.className = "tense-col";
        right.forEach((t) => {
          const label = document.createElement("label");
          label.innerHTML = `<input type="checkbox" value="${t.value}" /> ${t.label}`;
          col2.appendChild(label);
        });

        container.appendChild(col1);
        container.appendChild(col2);

        // ã€ŒALLã€æ’ä»–
        const boxes = container.querySelectorAll("input[type='checkbox']");
        const allBox = container.querySelector("input[value='ALL']");
        boxes.forEach((box) => {
          box.addEventListener("change", () => {
            if (box.value === "ALL" && box.checked) {
              boxes.forEach((cb) => {
                if (cb !== box) cb.checked = false;
              });
            } else if (box.value !== "ALL" && box.checked) {
              allBox.checked = false;
            } else {
              const any = [...boxes].some(
                (cb) => cb.checked && cb.value !== "ALL"
              );
              if (!any) allBox.checked = true;
            }
          });
        });
      }

      function startQuiz(mode) {
        const lang = document.getElementById("lang").value; // 'fr' | 'it'
        const boxes = document.querySelectorAll(
          "#tense-options input[type='checkbox']"
        );
        const selected = [...boxes]
          .filter((cb) => cb.checked)
          .map((cb) => cb.value);
        const tenseList = selected.includes("ALL") ? ["ALL"] : selected;

        sessionStorage.setItem("quiz_mode", mode);
        sessionStorage.setItem("selected_tenses", JSON.stringify(tenseList));
        sessionStorage.setItem("quiz_lang", lang);
        window.location.href = "/quizpage";
      }

      function resetQuiz() {
        fetch("/reset").then(() => {
          sessionStorage.clear();
          location.href = "/";
        });
      }

      window.addEventListener("DOMContentLoaded", () => {
        const savedLang = sessionStorage.getItem("quiz_lang") || "fr";
        document.getElementById("lang").value = savedLang;
        renderTenseCheckboxes(savedLang);

        document.getElementById("lang").addEventListener("change", (e) => {
          renderTenseCheckboxes(e.target.value);
        });

        fetch("/wrongcount")
          .then((r) => r.json())
          .then((data) => {
            const count = data.count || 0;
            const b = document.getElementById("review-button");
            b.textContent =
              count > 0
                ? `ğŸ” é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’ (${count})`
                : "ğŸ” é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’";
          });
      });
    </script>
  </body>
</html>
