<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>French Verb Quiz</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        text-align: center;
        padding: 0px;
      }
      h1 {
        font-size: 2.2em;
        margin-bottom: 40px;
      }
      .button {
        margin: 15px;
        padding: 15px 30px;
        font-size: 18px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: block;
        width: 280px;
        margin-left: auto;
        margin-right: auto;
      }
      .button:hover {
        background-color: #2980b9;
      }

      select {
        padding: 10px;
        font-size: 16px;
        margin-bottom: 50px;
      }
    </style>
  </head>
  <body>
    <h1>French Verb Conjugation Quiz</h1>

    <!-- âœ… è¿½åŠ ï¼šå‡ºé¡Œã™ã‚‹æ™‚åˆ¶ã®é¸æŠæ¬„ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ -->
    <h3>å‡ºé¡Œã™ã‚‹æ™‚åˆ¶ã‚’é¸ã‚“ã§ãã ã•ã„ï¼ˆè¤‡æ•°å¯ï¼‰</h3>
    <div
      id="tense-options"
      style="
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 20px;
        text-align: left;
      "
    >
      <div>
        <label><input type="checkbox" value="ALL" checked /> ã™ã¹ã¦</label
        ><br />
        <label
          ><input type="checkbox" value="prÃ©sent" /> ç¾åœ¨å½¢ï¼ˆprÃ©sentï¼‰</label
        ><br />
        <label
          ><input type="checkbox" value="futur simple" /> å˜ç´”æœªæ¥ï¼ˆfutur
          simpleï¼‰</label
        ><br />
        <label
          ><input type="checkbox" value="imparfait" />
          åŠéå»ï¼ˆimparfaitï¼‰</label
        ><br />
        <label
          ><input type="checkbox" value="passÃ© composÃ©" /> è¤‡åˆéå»ï¼ˆpassÃ©
          composÃ©ï¼‰</label
        ><br />
      </div>
      <div>
        <label
          ><input type="checkbox" value="impÃ©ratif" />
          å‘½ä»¤å½¢ï¼ˆimpÃ©ratifï¼‰</label
        ><br />
        <label
          ><input type="checkbox" value="conditionnel_prÃ©sent" />
          æ¡ä»¶æ³•ç¾åœ¨ï¼ˆconditionnel prÃ©sentï¼‰</label
        ><br />
        <label
          ><input type="checkbox" value="conditionnel_passÃ©" />
          æ¡ä»¶æ³•éå»ï¼ˆconditionnel passÃ©ï¼‰</label
        ><br />
        <label
          ><input type="checkbox" value="subjonctif_prÃ©sent" />
          æ¥ç¶šæ³•ç¾åœ¨ï¼ˆsubjonctif prÃ©sentï¼‰</label
        ><br />
        <label
          ><input type="checkbox" value="subjonctif_passÃ©" />
          æ¥ç¶šæ³•éå»ï¼ˆsubjonctif passÃ©ï¼‰</label
        ><br />
      </div>
    </div>

    <!-- å…ƒã®ãƒœã‚¿ãƒ³ç¾¤ -->
    <button class="button" onclick="startQuiz('normal')">
      â–¶ ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºé¡Œ
    </button>

    <button class="button" onclick="startQuiz('by_subject')">
      ğŸ”¢ äººç§°ã‚’é †ç•ªã«å‡ºé¡Œ
    </button>

    <button class="button" id="review-button" onclick="startQuiz('review')">
      ğŸ” é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’
    </button>

    <button class="button" onclick="resetQuiz()">âŒ è§£ç­”çŠ¶æ³ã‚’ãƒªã‚»ãƒƒãƒˆ</button>

    <!-- âœ… GIFç”»åƒã‚’ä¸­å¤®ã«è¡¨ç¤º -->
    <div style="margin-top: 30px">
      <img
        src="/static/menu.gif"
        alt="menuGIF"
        style="height: 200px; display: block; margin: 0 auto"
      />
    </div>

    <script>
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®æ’ä»–å‡¦ç†
      window.addEventListener("DOMContentLoaded", function () {
        const checkboxes = document.querySelectorAll(
          "#tense-options input[type='checkbox']"
        );
        const allBox = document.querySelector(
          "#tense-options input[value='ALL']"
        );

        checkboxes.forEach((box) => {
          box.addEventListener("change", () => {
            if (box.value === "ALL" && box.checked) {
              // ã€Œã™ã¹ã¦ã€ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚‰ä»–ã‚’å…¨éƒ¨å¤–ã™
              checkboxes.forEach((cb) => {
                if (cb !== box) cb.checked = false;
              });
            } else if (box.value !== "ALL" && box.checked) {
              // ä»–ãŒ1ã¤ã§ã‚‚ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚‰ã€Œã™ã¹ã¦ã€ã‚’å¤–ã™
              allBox.checked = false;
            } else {
              // ä½•ã‚‚ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã‘ã‚Œã°ã€Œã™ã¹ã¦ã€ã‚’æˆ»ã™
              const anyChecked = Array.from(checkboxes).some(
                (cb) => cb.checked && cb.value !== "ALL"
              );
              if (!anyChecked) allBox.checked = true;
            }
          });
        });
      });

      function startQuiz(mode) {
        const checkboxes = document.querySelectorAll(
          "#tense-options input[type='checkbox']"
        );
        const selected = Array.from(checkboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.value);

        const tenseList = selected.includes("ALL") ? ["ALL"] : selected;

        sessionStorage.setItem("quiz_mode", mode);
        sessionStorage.setItem("selected_tenses", JSON.stringify(tenseList));
        window.location.href = "/quizpage";
      }

      function resetQuiz() {
        fetch("/reset")
          .then(() => {
            sessionStorage.clear();
            window.location.href = "/";
          })
          .catch((error) => console.error("Error:", error));
      }

      window.onload = function () {
        fetch("/wrongcount")
          .then((response) => response.json())
          .then((data) => {
            const count = data.count || 0;
            const button = document.getElementById("review-button");
            button.textContent =
              count > 0
                ? `ğŸ” é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’ (${count})`
                : "ğŸ” é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’";
          })
          .catch((error) => {
            console.error("å¾©ç¿’æ•°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
          });
      };
    </script>
  </body>
</html>
